desc:MIDI Velocity Control
//tags: MIDI processing

slider1:1<-16,16,0.1>Velocity Multiply
slider2:0<-128,128,1>Velocity Add

in_pin:none
out_pin:none

@init

@block
while (
  midirecv(ts,msg1,msg23) ? (
    eventtype=msg1&$xf0;
    velocity=(msg23/256)|0;
    pitch=msg23&127;

    eventtype == 144 /* event type is NOTE ON */ && velocity > 0 ? (
      velocity = (velocity*slider1)+slider2;
      velocity|=0;

      velocity > 0 ? midisend(ts,msg1,pitch+velocity*256); // send note on
    ) : (
      midisend(ts,msg1,msg23); // passthru
    );
  );
);
